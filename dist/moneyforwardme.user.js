// ==UserScript==
// @name マネーフォワードME Web
// @description Make a few changes to the design of MoneyforwardME
// @version 0.1.4
// @author A.A
// @homepage https://github.com/aozou99/TampermonkeyScripts#readme
// @supportURL https://github.com/aozou99/TempermonkeyScripts
// @match https://moneyforward.com/bs/portfolio
// @match https://moneyforward.com/bs/history
// @downloadURL https://github.com/aozou99/TempermonkeyScripts/raw/main/src/moneyforwardme.user.js
// @grant none
// @iconURL https://assets.moneyforward.com/assets/favicon-710b014dd04a85070bb0a55fa894b599015b5310333d38da9c85ad03594bbc20.ico
// @namespace https://github.com/aozou99/TempermonkeyScripts
// @updateURL https://github.com/aozou99/TempermonkeyScripts/raw/main/src/moneyforwardme.user.js
// ==/UserScript==

(()=>{"use strict";var e,t,o,n={639:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleHistoryPage=void 0,t.handleHistoryPage=function(){console.log("todo impliments")}},311:(e,t)=>{function o(e,t){for(var o=e.getElementsByTagName("tr"),n=0,a=1;a<o.length;a++){var r=o[a].getElementsByTagName("td")[t];if(r){var c=(r.textContent||r.innerText).replace(/,/g,"").replace("円","").trim(),i=parseFloat(c);isNaN(i)||(n+=i)}}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.handlePortfolioPage=void 0,t.handlePortfolioPage=function(){var e;!function(e){var t,o,n,a,r=document.querySelector(".mf-col-custom-ad");r&&r.remove();var c=e.reduce((function(e,t){return Object.keys(t).forEach((function(o){if(!["評価損益率","Section名"].includes(o)){var n=o;n in e||(e[n]=0),e[n]+=t[n]}})),e}),{}),i=document.querySelector("section.bs-total-assets > div.heading-radius-box");if(i){i.classList.remove("mf-mb20"),i.classList.add("mf-mb0");var d=["有価証券： ".concat(c.評価額の合計.toLocaleString(),"円"),"評価損益： ".concat(c.評価損益の合計.toLocaleString(),"円")],l=i;d.forEach((function(e){var t,o=l.cloneNode();o.textContent=e,null===(t=l.parentNode)||void 0===t||t.insertBefore(o,l.nextSibling),l=o}))}var s=document.querySelector("section.bs-total-assets > h1.heading-small");if(s){var u=s.cloneNode();u.textContent="評価損益の内訳",u.style.borderLeftColor="green",null===(t=s.parentNode)||void 0===t||t.appendChild(u);var f=document.createElement("table");f.classList.add("table","table-bordered"),[{タイトル:"投資信託",リンク先:"portfolio_det_mf",評価損益:(null===(o=e.find((function(e){return"投資信託"===e.Section名})))||void 0===o?void 0:o.評価損益の合計)||0},{タイトル:"年金",リンク先:"portfolio_det_pns",評価損益:(null===(n=e.find((function(e){return"年金"===e.Section名})))||void 0===n?void 0:n.評価損益の合計)||0}].forEach((function(e){var t=document.createElement("tr"),o=document.createElement("th"),n=document.createElement("img");n.src="https://assets.moneyforward.com/assets/bs/icon_table_arrow-528280ce2bfa721a3a1ee5b7c9bfc6e14aee0a27737c4a3bf34d854cbae2091f.png";var a=document.createElement("a");a.href="portfolio#".concat(e.リンク先),a.textContent=e.タイトル,o.append(n),o.append(a),t.append(o);var r=document.createElement("td");r.textContent="".concat(e.評価損益.toLocaleString(),"円"),t.append(r);var i=document.createElement("td");i.textContent="".concat((e.評価損益/c.評価損益の合計*100).toFixed(2),"%"),t.append(i),f.appendChild(t)})),null===(a=null==i?void 0:i.parentNode)||void 0===a||a.appendChild(f)}}((e=[],[{id:"portfolio_det_mf",対象名:"投資信託",評価損益カラムIndex:6,評価額カラムIndex:4},{id:"portfolio_det_pns",対象名:"年金",評価損益カラムIndex:3,評価額カラムIndex:2}].forEach((function(t){var n=function(e){var t=document.querySelector("#".concat(e.id," > table")),n=o(t,e.評価損益カラムIndex),a=o(t,e.評価額カラムIndex),r=n/(a-n),c=a-n;return{Section名:e.対象名,評価損益の合計:n,評価額の合計:a,評価損益率:r,元本額の合計:c}}(t);!function(e,t,o){var n=document.querySelector("#".concat(e.id," > section > h1.heading-small"));n&&(n.textContent+="(評価損益： ".concat(t.toLocaleString(),"円、 評価損益率： ").concat((100*o).toFixed(2),"%)"))}(t,n.評価損益の合計,n.評価損益率),e.push(n)})),e))}}},a={};function r(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={exports:{}};return n[e](o,o.exports,r),o.exports}t=r(311),o=r(639),(e=window.location.href).includes("/bs/portfolio")?(0,t.handlePortfolioPage)():e.includes("/bs/history")&&(0,o.handleHistoryPage)()})();